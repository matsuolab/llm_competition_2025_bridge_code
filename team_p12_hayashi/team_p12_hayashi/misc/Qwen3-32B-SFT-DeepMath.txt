export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True

torchrun --standalone --nnodes=1 --nproc_per_node=8 \
  -m verl.trainer.fsdp_sft_trainer \
  data.train_files=$HOME/data/DeepMath-103K/train.parquet \
  data.val_files=$HOME/data/DeepMath-103K/test.parquet \
  data.prompt_key=problem \
  data.response_key=solution \
  data.prompt_dict_keys=[] \
  +data.response_dict_keys=[] \
  data.micro_batch_size_per_gpu=1 \
  data.max_length=4096 \
  model.partial_pretrain=$HOME/model/Qwen3-32B \
  '+model.attn_implementation=flash_attention_2' \
  '+model.torch_dtype=bfloat16' \
  model.fsdp_config.model_dtype=bfloat16 \
  model.enable_gradient_checkpointing=true \
  trainer.project_name=competition_verl_baseline \
  trainer.experiment_name=Qwen3-32B_SFT_DeepMath \
  trainer.total_epochs=4 \
  trainer.default_local_dir=$HOME/training/sft_Qwen3_DeepMath/checkpoints \
  trainer.logger=['console','wandb'] \
  trainer.resume_mode=disable