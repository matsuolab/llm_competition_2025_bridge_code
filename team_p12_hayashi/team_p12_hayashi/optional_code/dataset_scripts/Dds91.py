#　-*- coding: utf-8 -*-
import sys
import os
import re
import struct
import binascii
import numpy as np
# -------------------------------------------------------
# 1. ライブラリーのインポート, データ読込み
# ライブラリーのインポート
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
# -------------------------------------------------------
from datasets import load_dataset
from huggingface_hub import login
login("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")  # スクリプト内でトークンを使う方法
# # -------------------------------------------------------
import json
import csv
import glob
import os

# JSONLファイルのパスを取得（カレントディレクトリの .jsonl）
jsonl_files = glob.glob("*.jsonl")

# 各ファイルの1行目のキー一覧を収集（ファイル名を先頭に付ける）
rows = []
for file in jsonl_files:
    with open(file, "r", encoding="utf-8") as f:
        first_line = f.readline()
        if not first_line.strip():
            keys = []  # 空ファイル対策
        else:
            try:
                data = json.loads(first_line)
                keys = list(data.keys())
            except Exception as e:
                print(f"{file} の読み込みに失敗: {e}")
                keys = []
        # 先頭にファイル名を追加
        row = [os.path.basename(file)] + keys
        rows.append(row)

# 最大列数を取得し、各行をパディング
max_len = max(len(row) for row in rows)
padded_rows = [row + [""] * (max_len - len(row)) for row in rows]

# 出力CSVファイルを保存
output_csv = "jsonl_keys_summary_with_filename.csv"
with open(output_csv, "w", encoding="utf-8", newline="") as f:
    writer = csv.writer(f)
    writer.writerow(["filename"] + [f"key{i+1}" for i in range(max_len - 1)])  # ヘッダー行
    writer.writerows(padded_rows)

print(f"CSVファイル '{output_csv}' に {len(rows)} 行を書き出しました。")
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------
# # -------------------------------------------------------

